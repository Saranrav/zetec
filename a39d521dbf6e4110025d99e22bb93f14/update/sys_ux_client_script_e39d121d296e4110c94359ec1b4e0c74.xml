<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ux_client_script">
    <sys_ux_client_script action="INSERT_OR_UPDATE">
        <includes/>
        <macroponent display_value="Landing page">639d121d776e41102aa3858bdf4c0476</macroponent>
        <name>PR_calculate_state_values</name>
        <required_translations>[ ]</required_translations>
        <script><![CDATA[/**
 * @param {params} params
 * @param {api} params.api
 * @param {any} params.event
 * @param {any} params.imports
 */
function handler({
    api,
    event,
    helpers,
    imports
}) {


    const {
        data,
        state,
        setState,
        context
    } = api;

    const propNames = {
        propName1: 'x_742047_zetec.end_date'
    };

     const {
        snHttp
    } = helpers;

    // To calculate the remaining days to complete the review 
    const prompt_date = snHttp('/api/x_742047_zetec/prop_mgmt?property_name=' + propNames.propName1, {
        method: 'GET',
        batch: false,
    }).then(response => {

        var now = new Date();
        // returns review date in msec
        var review_date = Date.parse(response.response.result.end_date.toString());
        var diff = review_date - now.getTime();
        var noOfDays = Math.round(diff / (1000 * 60 * 60 * 24)).toFixed(0);
        if (noOfDays > 0)
            setState('moreDays', noOfDays);
       
    }).catch(error => {
        console.log(error.message);
    });

    // To calculate the totalRecCount
    const currentUser = api.context.session.user.sys_id;
    // stats is to do aggregate API, gets the count (sysparm_count)
    snHttp("/api/now/stats/x_742047_zetec_performance_review?sysparm_count=true&sysparm_query=active=true^manager.sys_id=" + currentUser, {
        method: "GET",
        batch: false,
    }).then(response => {
        if (response.response.result.stats.count > 0) {

            setState('totalRecCount', response.response.result.stats.count);

        }
    }).catch(error => {
        console.log('Error');
    });

    // calculate totalRecConfirmed State
    snHttp("/api/now/stats/x_742047_zetec_performance_review?sysparm_count=true&sysparm_query=active=true^state=confirmed^manager.sys_id=" + currentUser, {
        method: "GET",
        batch: false,
    }).then(response => {
        if (response.response.result.stats.count > 0) {

            setState('totalRecConfirmed', response.response.result.stats.count);

        }
    }).catch(error => {
        console.log('Error');
    });

    // calculate totalRecInProgress State
    snHttp("/api/now/stats/x_742047_zetec_performance_review?sysparm_count=true&sysparm_query=active=true^state!=confirmed^state !=draft^manager.sys_id=" + currentUser, {
        method: "GET",
        batch: false,
    }).then(response => {
        if (response.response.result.stats.count > 0) {

            setState('totalRecInProgress', response.response.result.stats.count);

        }
    }).catch(error => {
        console.log('Error');
    });
}]]></script>
        <script_api_version>2.0.0</script_api_version>
        <sys_class_name>sys_ux_client_script</sys_class_name>
        <sys_created_by>aes.creator</sys_created_by>
        <sys_created_on>2022-03-29 11:01:50</sys_created_on>
        <sys_id>e39d121d296e4110c94359ec1b4e0c74</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>PR_calculate_state_values</sys_name>
        <sys_package display_value="zetec" source="x_742047_zetec">a39d521dbf6e4110025d99e22bb93f14</sys_package>
        <sys_policy/>
        <sys_scope display_value="zetec">a39d521dbf6e4110025d99e22bb93f14</sys_scope>
        <sys_update_name>sys_ux_client_script_e39d121d296e4110c94359ec1b4e0c74</sys_update_name>
        <sys_updated_by>aes.creator</sys_updated_by>
        <sys_updated_on>2022-03-29 11:01:50</sys_updated_on>
        <type/>
    </sys_ux_client_script>
</record_update>
